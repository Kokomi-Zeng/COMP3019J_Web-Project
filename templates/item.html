{% extends "base.html" %}

{% block title %}
{{ product_id }}
{% endblock %}

{% block script %}
    <script>
    window.onload = function () {
        $.ajax({
            url: "/getSession",
            type: "get",
            success: function (data) {
                phone = data.phone;
                name = data.name;
                type = data.type;
            }
        })

        $.ajax({
            url: "/itemInfoById",
            type: "get",
            data: {
                product_id: "{{ product_id }}"
            },
            success: function (data) {
                let img;
                let name;
                let star;
                let price;
                let storage
                if ("{{ belong }}"==="false"){
                    img = document.createElement("img");
                    name = document.createElement("span");
                    star = document.createElement("span");
                    price = document.createElement("span");
                    storage = document.createElement("span");

                    img.setAttribute("src", data.src);
                    $(".img-box").append(img);

                    name.innerText = data.name;
                    $(".item-name-box").append(name);

                    star.innerText = data.star;
                    $(".item-star-box").append(star);

                    price.innerText = data.price;
                    $(".item-price-box").append(price);

                    storage.innerText = data.storage;
                    $(".item-storage-box").append(storage);
                }else {
                    img = document.createElement("img");
                    name = document.createElement("input");
                    star = document.createElement("input");
                    price = document.createElement("input");
                    storage = document.createElement("input");

                    img.setAttribute("src", data.src);
                    $(".img-box").append(img);name.setAttribute("type", "text")
                    name.value = data.name;
                    $(".item-name-box").append(name);

                    star.setAttribute("type", "text")
                    star.value = data.star;
                    $(".item-star-box").append(star);

                    price.setAttribute("type", "text")
                    price.value = data.price;
                    $(".item-price-box").append(price);

                    storage.setAttribute("type", "text")
                    storage.value = data.storage;
                    $(".item-storage-box").append(storage);
                }

                const name_div = document.createElement("div");
                const star_div = document.createElement("div");
                const price_div = document.createElement("div");
                const storage_div = document.createElement("div");

            }
        })

        $.ajax({
            url: "commentBasicInfoById",
            type: "get",
            data: {
                product_id: "{{ product_id }}"
            },
            success: function (data) {
                for (let i = 0; i < data.length; i++) {
                    const comment = data[i];
                    const comment_div = document.createElement("div");
                    comment_div.setAttribute("class", "comment");

                    const comment_star_div = document.createElement("div");
                    comment_star_div.setAttribute("class", "comment-star");
                    comment_div.append(comment_star_div);

                    {#create dom and insert data of star#}

                    const comment_text_div = document.createElement("div");
                    comment_text_div.setAttribute("class", "comment-text");
                    comment_div.append(comment_text_div);

                    const comment_text = document.createComment("p");
                    comment_text.innerText = comment.text;

                    $(".item-comment-box").append(comment_div);
                }
            }
        })

        {% if belong==false %}

                const buy_num = document.createElement("input");
                buy_num.setAttribute("type", "num");
                buy_num.setAttribute("placeHolder", "1");
                buy_num.setAttribute("id", "buy-num");

                const buy_button = document.createElement("button");
                buy_button.setAttribute("id", "buy-button");
                buy_button.innerText = "BUY!";
                buy_button.onclick = function () {
                    $.ajax({
                        url: "/buyer/buyItem",
                        type: "get",
                        contentType: "application/json",
                        dataType: "json",
                        data: {
                            product_id: "{{ product_id }}",
                            phone: phone,
                            num: buy_num.value,
                        },
                        success: function (data) {
                            alert(data)
                        }
                    })
                };
                const buy_box = $(".buy-box");
                buy_box.append(buy_num);
                buy_box.append(buy_button);
        {% endif %}
    }
    </script>
{% endblock %}

{% block main %}
<div class="left-box">
    <div class="img-box"></div>
    <div class="message-box">
        <div class="item-name-box"></div>
        <div class="item-star-box"></div>
        <div class="item-price-box"></div>
        <div class="item-storage-box"></div>
    </div>
    <div class="operation-box">
        <div class="buy-operation">
            <div class="buy-box">
            </div>
        </div>
        <div>
            <div class="look-more-comment">
                <button id="comment-button">COMMENT</button>
            </div>
        </div>
    </div>
</div>
<div class="right-box">
    <div class="item-comment-box"></div>
    <div class="self-comment-box"></div>
</div>
{% endblock %}